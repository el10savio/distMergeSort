#!/usr/bin/env bats

@test "Sort Large List" {
	ports="$(docker ps | awk '/sort/ {print $1}' | xargs -I {} docker port {} 8080 | sed ':a;N;$!ba;s/\n/,/g' | sort)"
	IFS=', ' read -r -a ports_list <<< "$ports"

	node1="${ports_list[0]}"

	response="$(curl -sS -XPOST http://$node1/sort --data '{"values": [703,519,129,791,417,296,125,511,219,790,71,566,479,325,738,61,602,106,729,683,418,370,162,599,523,69,444,82,797,346,718,895,690,877,149,140,354,429,176,808,87,241,565,554,308,726,366,377,229,53,284,58,748,912,85,234,735,402,589,687,185,499,583,725,846,563,416,855,765,881,848,994,686,888,400,835,567,212,776,796,166,854,363,740,539,186,845,778,838,661,633,163,150,883,193,148,483,652,300,723,945,680,581,903,600,716,515,513,766,543,914,441,576,920,395,571,862,202,779,762,952,228,719,769,481,56,44,122,620,884,570,7,670,205,406,678,248,837,414,772,164,36,33,396,865,351,440,277,280,470,700,714,344,411,156,995,810,447,989,360,799,27,476,51,81,505,871,844,26,50,62,334,468,247,794,327,423,681,335,986,842,291,980,305,427,113,130,664,501,302,220,774,94,32,250,121,127,979,120,643,413,337,345,45,293,24,477,326,530,223,830,84,815,89,452,734,141,651,684,257,74,702,635,552,463,175,929,295,446,445,268,917,378,194,482,564,355,448,722,657,19,755,155,328,601,435,631,192,170,393,950,14,86,492,860,831,717,188,851,436,771,819,151,226,397,116,434,373,503,273,936,792,13,92,984,788,134,937,644,708,615,697,485,383,469,331,40,123,971,30,520,604,522,508,893,235,970,375,624,607,868,551,890,933,706,525,83,76,368,861,364,455,801,350,494,321,742,909,189,573,392,866,879,227,693,785,104,154,224,23,264,947,252,517,153,380,745,458,786,419,374,201,974,609,191,55,804,274,728,215,356,598,595,124,689,586,629,2,52,251,820,457,780,509,603,210,746,315,474,550,577,990,108,332,548,759,20,276,549,988,254,131,88,608,572,526,826,77,800,992,613,553,143,588,146,408,733,271,823,611,68,115,11,557,900,491,312,243,137,605,182,743,787,478,304,95,449,244,390,537,347,590,825,630,204,430,685,764,10,198,367,259,627,313,1,628,647,388,632,461,480,747,217,913,578,214,870,500,636,752,299,518,343,72,606,610,236,70,314,983,656,9,269,15,172,459,197,169,496,579,338,97,384,591,580,574,954,816,471,617,867,261,275,421,679,38,450,813,495,695,29,258,142,843,349,486,911,111,665,944]}')" && [ "$response" == "[1,2,7,9,10,11,13,14,15,19,20,23,24,26,27,29,30,32,33,36,38,40,44,45,50,51,52,53,55,56,58,61,62,68,69,70,71,72,74,76,77,81,82,83,84,85,86,87,88,89,92,94,95,97,104,106,108,111,113,115,116,120,121,122,123,124,125,127,129,130,131,134,137,140,141,142,143,146,148,149,150,151,153,154,155,156,162,163,164,166,169,170,172,175,176,182,185,186,188,189,191,192,193,194,197,198,201,202,204,205,210,212,214,215,217,219,220,223,224,226,227,228,229,234,235,236,241,243,244,247,248,250,251,252,254,257,258,259,261,264,268,269,271,273,274,275,276,277,280,284,291,293,295,296,299,300,302,304,305,308,312,313,314,315,321,325,326,327,328,331,332,334,335,337,338,343,344,345,346,347,349,350,351,354,355,356,360,363,364,366,367,368,370,373,374,375,377,378,380,383,384,388,390,392,393,395,396,397,400,402,406,408,411,413,414,416,417,418,419,421,423,427,429,430,434,435,436,440,441,444,445,446,447,448,449,450,452,455,457,458,459,461,463,468,469,470,471,474,476,477,478,479,480,481,482,483,485,486,491,492,494,495,496,499,500,501,503,505,508,509,511,513,515,517,518,519,520,522,523,525,526,530,537,539,543,548,549,550,551,552,553,554,557,563,564,565,566,567,570,571,572,573,574,576,577,578,579,580,581,583,586,588,589,590,591,595,598,599,600,601,602,603,604,605,606,607,608,609,610,611,613,615,617,620,624,627,628,629,630,631,632,633,635,636,643,644,647,651,652,656,657,661,664,665,670,678,679,680,681,683,684,685,686,687,689,690,693,695,697,700,702,703,706,708,714,716,717,718,719,722,723,725,726,728,729,733,734,735,738,740,742,743,745,746,747,748,752,755,759,762,764,765,766,769,771,772,774,776,778,779,780,785,786,787,788,790,791,792,794,796,797,799,800,801,804,808,810,813,815,816,819,820,823,825,826,830,831,835,837,838,842,843,844,845,846,848,851,854,855,860,861,862,865,866,867,868,870,871,877,879,881,883,884,888,890,893,895,900,903,909,911,912,913,914,917,920,929,933,936,937,944,945,947,950,952,954,970,971,974,979,980,983,984,986,988,989,990,992,994,995]" ]
}

